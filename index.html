<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>One-File Stream Player</title>

<!-- Shaka Player CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shaka-player@4.3.5/dist/controls.css">
<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.5/dist/shaka-player.ui.js"></script>

<style>
    body { 
        font-family: Arial; 
        background:#121212; 
        color:white; 
        margin:0; 
        padding:20px;
    }
    #video-container {
        width:100%;
        max-width:900px;
        margin:auto;
        border:2px solid #333;
        border-radius:10px;
        overflow:hidden;
    }
    input, select, button {
        width:100%;
        padding:10px;
        margin:8px 0;
        border-radius:5px;
        border:none;
        font-size:15px;
    }
    button {
        background:#0af;
        color:black;
        font-weight:bold;
        cursor:pointer;
    }
    #controls { 
        max-width:900px; 
        margin:20px auto;
    }
    #error { color:red; font-size:14px; }
</style>
</head>

<body>

<h2>One-File Stream Player</h2>

<div id="video-container" data-shaka-player-container>
    <video id="video" autoplay muted data-shaka-player></video>
</div>

<div id="controls">
    <label>Manifest URL (HLS / MPD)</label>
    <input id="manifest" placeholder="https://converse.nathcreqtives.com/playlist.m3u">

    <label>DRM Type</label>
    <select id="drmType">
        <option value="none">None</option>
        <option value="com.widevine.alpha">Widevine</option>
        <option value="org.w3.clearkey">ClearKey</option>
    </select>

    <input id="licenseUrl" placeholder="Widevine License URL" style="display:none;">
    <input id="ck_kid" placeholder="ClearKey KID (hex)" style="display:none;">
    <input id="ck_key" placeholder="ClearKey KEY (hex)" style="display:none;">

    <button onclick="loadStream()">PLAY</button>
    <p id="error"></p>
</div>

<script>
let player;

document.addEventListener("DOMContentLoaded", () => {
    shaka.polyfill.installAll();

    if (!shaka.Player.isBrowserSupported()) {
        showError("Your browser does not support Shaka Player.");
        return;
    }

    const video = document.getElementById("video");
    player = new shaka.Player(video);
    player.addEventListener("error", onError);
});

function loadStream() {
    const url = document.getElementById("manifest").value.trim();
    const drm = document.getElementById("drmType").value;
    const lic = document.getElementById("licenseUrl").value.trim();
    const kid = document.getElementById("ck_kid").value.trim();
    const key = document.getElementById("ck_key").value.trim();

    const config = { drm: {} };

    if (drm === "com.widevine.alpha" && lic) {
        config.drm.servers = {
            "com.widevine.alpha": lic
        };
    }

    if (drm === "org.w3.clearkey" && kid && key) {
        config.drm.clearKeys = {
            [kid]: key
        };
    }

    player.configure(config);

    player.load(url)
        .then(() => console.log("Playing:", url))
        .catch(onError);
}

function onError(e) {
    showError("Player Error: " + e.detail.code);
    console.error(e);
}

function showError(msg) {
    document.getElementById("error").textContent = msg;
}

document.getElementById("drmType").addEventListener("change", (e) => {
    const t = e.target.value;

    document.getElementById("licenseUrl").style.display =
        t === "com.widevine.alpha" ? "block" : "none";

    document.getElementById("ck_kid").style.display =
        t === "org.w3.clearkey" ? "block" : "none";

    document.getElementById("ck_key").style.display =
        t === "org.w3.clearkey" ? "block" : "none";
});
</script>

</body>
</html>
