<!DOCTYPE html>
<html lang="tl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>IPTV Mobile · Shaka (One-file)</title>

  <!-- Shaka Player -->
  <script src="https://unpkg.com/shaka-player@4.9.2/dist/shaka-player.ui.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/shaka-player@4.9.2/dist/controls.css" />

  <style>
    :root { --bg:#0b0f14; --panel:#121821; --text:#e8eef7; --muted:#9fb0c7; --accent:#4cc9f0; }
    *{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
    .topbar,.bottombar{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--panel);position:sticky;z-index:10}
    .topbar{top:0}.bottombar{bottom:0;justify-content:space-between}
    .topbar h1{margin:0;font-size:1.1rem}
    .topbar input{flex:1;padding:.5rem .75rem;border-radius:.6rem;border:1px solid #1f2733;background:#0e141c;color:var(--text)}
    .layout{display:grid;grid-template-columns:1fr}
    .sidebar{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;padding:.75rem;overflow-y:auto;max-height:40vh}
    @media(min-width:900px){.layout{grid-template-columns:320px 1fr;height:calc(100vh - 104px)}.sidebar{max-height:unset;border-right:1px solid #1f2733}}
    .channel{display:flex;align-items:center;gap:.6rem;padding:.6rem;border-radius:.6rem;background:#0e141c;border:1px solid #1f2733;cursor:pointer}
    .channel:hover{border-color:var(--accent)}
    .logo{width:36px;height:36px;border-radius:.4rem;background:#1a2230;display:grid;place-items:center;color:var(--muted);font-size:.8rem;overflow:hidden}
    .meta{display:grid}.title{font-weight:600;font-size:.95rem}.cat{font-size:.75rem;color:var(--muted)}
    .player-wrap{padding:.75rem}
    .video-container{position:relative;aspect-ratio:16/9;background:#000;border-radius:.6rem;overflow:hidden;border:1px solid #1f2733}
    .shaka-controls-container{--shaka-controls-bg:rgba(0,0,0,.35)}
    .now-playing{margin-top:.5rem;color:var(--muted)}
    .controls-extra{display:flex;gap:.5rem;margin-top:.5rem}
    .controls-extra button{flex:1;padding:.5rem;border-radius:.6rem;border:1px solid #1f2733;background:#0e141c;color:var(--text)}
    .volume-slider{flex:2}
  </style>
</head>
<body>
  <header class="topbar">
    <h1>IPTV</h1>
    <input id="search" type="search" placeholder="Hanapin channel..." />
  </header>

  <main class="layout">
    <aside class="sidebar" id="channelList"></aside>
    <section class="player-wrap">
      <div class="video-container">
        <video id="video" class="shaka-video" playsinline></video>
        <div id="controls" class="shaka-controls-container"></div>
      </div>
      <div class="now-playing" id="nowPlaying">Walang napiling channel</div>
      <div class="controls-extra">
        <button id="chMinus">CH-</button>
        <button id="playPause">⏯</button>
        <button id="chPlus">CH+</button>
        <input id="volume" type="range" min="0" max="1" step="0.05" class="volume-slider"/>
      </div>
    </section>
  </main>

  <footer class="bottombar">
    <button id="reloadBtn">Reload playlist</button>
    <select id="categoryFilter"><option value="">Lahat</option></select>
  </footer>

  <script type="module">
    const PLAYLIST_URL = "https://raw.githubusercontent.com/reiyhbit/iptv/refs/heads/main/lgtv.m3u";
    const state = {channels:[],filtered:[],categories:new Set(),player:null,ui:null,currentIndex:0};

    function parseM3U(text){
      const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);const channels=[];
      for(let i=0;i<lines.length;i++){if(lines[i].startsWith("#EXTINF")){
        const info=lines[i],url=lines[i+1]||"",name=(info.match(/,(.*)$/)||["","Unknown"])[1].trim();
        const getAttr=k=>(info.match(new RegExp(`${k}="([^"]*)"`,"i"))||[])[1]||"";
        channels.push({name,url,logo:getAttr("tvg-logo"),group:getAttr("group-title")});i++;}}
      return channels;
    }

    async function loadPlaylist(){
      const res=await fetch(PLAYLIST_URL);const text=await res.text();
      state.channels=parseM3U(text).filter(c=>c.url.startsWith("http"));state.filtered=[...state.channels];
      state.categories=new Set(state.channels.map(c=>c.group).filter(Boolean));renderCategories();renderList();
      if(state.channels.length>0){state.currentIndex=0;playChannel(state.channels[0]);} // auto-play first
    }

    function renderCategories(){
      const sel=document.getElementById("categoryFilter");sel.innerHTML="<option value=''>Lahat</option>";
      [...state.categories].sort().forEach(cat=>{const o=document.createElement("option");o.value=cat;o.textContent=cat;sel.appendChild(o);});
    }

    function renderList(){
      const wrap=document.getElementById("channelList");wrap.innerHTML="";
      state.filtered.forEach((ch,idx)=>{const item=document.createElement("div");item.className="channel";item.onclick=()=>{state.currentIndex=idx;playChannel(ch)};
        const logo=document.createElement("div");logo.className="logo";logo.textContent=ch.name.slice(0,2).toUpperCase();
        if(ch.logo){const img=document.createElement("img");img.src=ch.logo;img.style.width="100%";img.style.height="100%";img.style.objectFit="cover";logo.textContent="";logo.appendChild(img);}
        const meta=document.createElement("div");meta.className="meta";meta.innerHTML=`<div class='title'>${ch.name}</div><div class='cat'>${ch.group||""}</div>`;
        item.appendChild(logo);item.appendChild(meta);wrap.appendChild(item);});
    }

    function initShaka(){
      const video=document.getElementById("video");const player=new shaka.Player(video);
      const ui=new shaka.ui.Overlay(player,document.getElementById("controls"),video);
      ui.configure({addBigPlayButton:true});state.player=player;state.ui=ui;
    }

    async function playChannel(ch){
      const np=document.getElementById("nowPlaying");np.textContent=`Naglo-load: ${ch.name}`;
      try{await state.player.load(ch.url);np.textContent=`Now Playing: ${ch.name}`;document.getElementById("video").play();}
      catch(err){np.textContent=`Error: ${err.message}`;}
    }

    function wireEvents(){
      document.getElementById("search").addEventListener("input",e=>{
        const q=e.target.value.toLowerCase();state.filtered=state.channels.filter(c=>c.name.toLowerCase().includes(q)||(c.group||"").toLowerCase().includes(q));renderList();
      });
      document.getElementById("categoryFilter").addEventListener("change",e=>{
        const val=e.target.value;state.filtered=state.channels.filter(c=>!val||c.group===val);renderList();
      });
      document.getElementById("reloadBtn").onclick=loadPlaylist;
      document.getElementById("chPlus").onclick=()=>{if(state.currentIndex<state.channels.length-1){state.currentIndex++;playChannel(state.channels[state.currentIndex]);}};
      document.getElementById("chMinus").onclick=()=>{if(state.currentIndex>0){state.currentIndex--;playChannel(state.channels[state.currentIndex]);}};
      document.getElementById("playPause").onclick=()=>{
        const v=document.getElementById("video");if(v.paused){v.play();}else{v.pause();}
      };
          function wireEvents(){
      document.getElementById("search").addEventListener("input",e=>{
        const q=e.target.value.toLowerCase();
        state.filtered=state.channels.filter(c=>
          c.name.toLowerCase().includes(q)||(c.group||"").toLowerCase().includes(q)
        );
        renderList();
      });

      document.getElementById("categoryFilter").addEventListener("change",e=>{
        const val=e.target.value;
        state.filtered=state.channels.filter(c=>!val||c.group===val);
        renderList();
      });

      document.getElementById("reloadBtn").onclick=loadPlaylist;

      document.getElementById("chPlus").onclick=()=>{
        if(state.currentIndex<state.channels.length-1){
          state.currentIndex++;
          playChannel(state.channels[state.currentIndex]);
        }
      };
      document.getElementById("chMinus").onclick=()=>{
        if(state.currentIndex>0){
          state.currentIndex--;
          playChannel(state.channels[state.currentIndex]);
        }
      };
      document.getElementById("playPause").onclick=()=>{
        const v=document.getElementById("video");
        if(v.paused){v.play();}else{v.pause();}
      };
      document.getElementById("volume").oninput=(e)=>{
        document.getElementById("video").volume=parseFloat(e.target.value);
      };
    }

    document.addEventListener("DOMContentLoaded",async()=>{
      initShaka();
      wireEvents();
      await loadPlaylist();
    });
  </script>
</body>
</html>

